<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
    <title>Read Only by HTML5 UP</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/css/main.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
</head>

<body>
    <!-- Header -->
    <section id="header">
        <header>
            <span class="image avatar"><img src="images/avatar.png" alt="" /></span>
            <h1 id="logo"><a href="#">Node + PassportJS</a></h1>
            <p>Easy authentication your NodeJS apps with PassportJS</p>
        </header>
        <nav id="nav">
            <ul>
                <li><a href="#intro" class="active">Introduction</a></li>
                <li><a href="#passportjs">PassportJS</a></li>
                <li><a href="#oauth">OAuth</a></li>
                <li><a href="#demo">Demo</a></li>
                <li><a href="#writing-app">Writing your own app</a></li>
            </ul>
        </nav>
        <footer>
            Luis PÃ©rez - lperez@avenuecode.com
            <br/> Pedro Dias - pdias@avenuecode.com
        </footer>
    </section>
    <!-- Wrapper -->
    <div id="wrapper">
        <!-- Main -->
        <div id="main">
            <!-- One -->
            <section id="intro">
                <div class="container">
                    <header class="major">
                        <h2>NodeJS + PassportJS</h2>
                        <p>Simple, unobtrusive authentication for Node.js.</p>
                        <ul>
                            <li><a href="http://passportjs.org/">Passportjs.org</a></li>
                            <li><a href="https://github.com/xilenomg/node-passportjs">https://github.com/xilenomg/node-passportjs</a></li>
                        </ul>
                    </header>
                    <p></p>
                </div>
            </section>
            <!-- Two -->
            <section id="passportjs">
                <div class="container">
                    <h3>PassportJS</h3>
                    <p></p>
                </div>
            </section>
            <!-- Three -->
            <section id="oauth">
                <div class="container">
                    <h3>OAuth</h3>
                    <p></p>
                </div>
            </section>
            <!-- Three -->
            <section id="demo">
                <div class="container">
                    <h3>Demo</h3>
                    <video id="sampleMovie" width="640" height="360" preload controls>
                        <source src="assets/video/demo.mov" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"' />
                        <object type="application/x-shockwave-flash" data="http://releases.flowplayer.org/swf/flowplayer-3.2.1.swf" width="640" height="360">
                            <param name="movie" value="http://releases.flowplayer.org/swf/flowplayer-3.2.1.swf" />
                            <param name="allowFullScreen" value="true" />
                            <param name="wmode" value="transparent" />
                            <param name="flashvars" value='config={"clip":{"url":"assets/video/demo.mov","autoPlay":false,"autoBuffering":true}}' />
                        </object>
                    </video>
                </div>
            </section>
            <!-- Four -->
            <section id="writing-app">
                <div class="container">
                    <h3>Writing your own app</h3>
                    <section>
                        <h4>Setup</h4>
                        <ul>
                            <li>npm init</li>
                            <li>npm install bcrypt-nodejs body-parser connect-flash cookie-parser ejs express express-session method-override mongoose morgan passport passport-local passport-facebook passport-google-oauth passport-local passport-twitter --save</li>
                        </ul>
                    </section>
                    <section>
                        <h4>Configuration Files</h4>
                        <h5>/config/auth.js</h5>
                        <pre><code>
// expose our config directly to our application using module.exports
module.exports = {};
						</code></pre>
                        <h5>/config/database.js</h5>
                        <pre><code>
module.exports = {
	'url': 'mongodb://localhost/node-passport'
}
						</code></pre>
                        <h5>/config/passport.js</h5>
                        <pre><code>
module.exports = function(passport) {}
						</code></pre>
                        <h5>/app/routes.js</h5>
                        <pre><code>
module.exports = function(passport) {}
                        </code></pre>
                    </section>
                    <section>
                        <h4>Index.js</h4>
                        <pre><code>
//libraries required
//express framework
var express = require('express');
var app = express();
//mongo connector
var mongoose = require('mongoose');
//Passport
var passport = require('passport');
//Flash messages stored in session
var flash = require('connect-flash');
//log request to the log
var morgan = require('morgan');
//read cookies
var cookieParser = require('cookie-parser');
//get information from html forms
var bodyParser = require('body-parser');
//session
var session = require('express-session');

var PORT = process.env.PORT || 8080;


//database
var databaseConfig = require('./config/database.js');
mongoose.connect(databaseConfig.url);

//passport
require('./config/passport')(passport);


//APP use
app.use(morgan('dev'));
app.use(cookieParser());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true })); //Returns middleware that only parses urlencoded bodies. This parser accepts only UTF-8 encoding of the body and supports automatic inflation of gzip and deflate encodings.

//setup view
app.set('view engine', 'ejs');

//session setup
app.use(session({ secret: 'avenuecode-passport-training', resave: true, saveUninitialized: false }));
//secret - This is the secret used to sign the session ID cookie
//resave - Forces the session to be saved back to the session store, even if the session was never modified during the request. 
//saveUninitialized - Forces a session that is "uninitialized" to be saved to the store.
//https://www.npmjs.com/package/express-session


//passport setup
app.use(passport.initialize());
app.use(passport.session());

//flash message setup
app.use(flash());

//routes
require('./app/routes.js')(app, passport);

//listen to port
app.listen(PORT, function() {
    console.log("Open your browser at http://localhost:" + PORT);
});

                        </code></pre>
                    </section>
                    <section>
                        <h4>Starting Server</h4>
                        <pre><code>$ mongod --dbpath ~/path/to/folder</code></pre>
                        <pre><code>$ node index  #nodemon index.js (npm install nodemon -g)</code></pre>
                    </section>
                    <section>
                        <h4>Model</h4>
                        <h5>/app/models/user.js</h5>
                        <pre><code>


// load the things we need
var mongoose = require('mongoose');
var bcrypt   = require('bcrypt-nodejs');

// define the schema for our user model
var userSchema = mongoose.Schema({

    local            : {
        email        : String,
        password     : String
    },
    facebook         : {
        id           : String,
        token        : String,
        email        : String,
        name         : String
    },
    twitter          : {
        id           : String,
        token        : String,
        displayName  : String,
        username     : String
    },
    google           : {
        id           : String,
        token        : String,
        email        : String,
        name         : String
    }

});

// generating a hash
userSchema.methods.generateHash = function(password) {
    return bcrypt.hashSync(password, bcrypt.genSaltSync(8), null);
};

// checking if password is valid
userSchema.methods.validPassword = function(password) {
    return bcrypt.compareSync(password, this.local.password);
};

// create the model for users and expose it to our app
module.exports = mongoose.model('User', userSchema);

                        </code></pre>
                    </section>
                    <section>
                        <h4>Views</h4>
                    </section>
                    <section>
                        <h4>Render</h4>
                    </section>
                    <section>
                        <h4>Local Signup</h4>
                    </section>
                    <section>
                        <h4>Local Login</h4>
                    </section>
                    <section>
                        <h4>Profile</h4>
                    </section>
                    <section>
                        <h4>Logout</h4>
                    </section>
                    <section>
                        <h4>Facebook</h4>
                    </section>
                    <section>
                        <h4>Twitter</h4>
                    </section>
                    <section>
                        <h4>Google</h4>
                    </section>
                    <section>
                        <h4>Link Accounts</h4>
                    </section>
                    <section>
                        <h4>Local</h4>
                    </section>
                    <section>
                        <h4>Facebook</h4>
                    </section>
                    <section>
                        <h4>Twitter</h4>
                    </section>
                    <section>
                        <h4>Google</h4>
                    </section>
                    <section>
                        <h4>Unlink Accounts</h4>
                    </section>
                    <section>
                        <h4>End</h4>
                    </section>
                </div>
            </section>
        </div>
        <!-- Footer -->
        <section id="footer">
            <div class="container">
                <ul class="copyright">
                    <li>&copy; Untitled. All rights reserved.</li>
                    <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                </ul>
            </div>
        </section>
    </div>
    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollzer.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
    <script src="assets/js/main.js"></script>
</body>

</html>
